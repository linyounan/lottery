<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>å°ˆæ¥­æŠ½çç¨‹å¼</title>
<style>
body {
  font-family: "Comic Sans MS","è¯åº·æ‰‹æœ­é«”","å¾®è»Ÿæ­£é»‘é«”",sans-serif;
  display: flex;
  margin: 0;
  height: 100vh;
  background: #f0f4f8;
}
/* å·¦å´åŠŸèƒ½å€ */
.left { width: 40%; padding: 20px; box-sizing: border-box; background: #ffffff; box-shadow: 3px 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
.left h2 { margin-top: 0; color: #333; border-bottom: 2px solid #ff7f50; padding-bottom: 5px; }
.left textarea { width: 95%; height: 220px; padding: 12px; font-size: 16px; border-radius: 12px; border: 1px solid #ccc; resize: none; margin-bottom: 15px; box-shadow: inset 0 0 8px rgba(0,0,0,0.05); }
.left input[type="text"], .left input[type="number"] { width: 48%; padding: 8px; margin: 5px 1%; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; box-sizing:border-box; }
.left button { padding: 10px 15px; margin: 5px 0; border: none; cursor:pointer; border-radius:8px; font-size:14px; font-weight:bold; transition: all 0.2s; }
.left button.btn-start { background: linear-gradient(45deg,#ff9a3c,#ff6f00); color:white; }
.left button.btn-start:hover { background: linear-gradient(45deg,#ff6f00,#ff9a3c); }
.left button.btn-gray { background:#9e9e9e; color:white; }
.left button.btn-gray:hover { background:#757575; }
/* å³å´é¡¯ç¤ºå€ */
.right { width: 60%; display: flex; align-items: center; justify-content:flex-start; background:#fdf6e3; flex-direction:column; position: relative; padding-top:60px; }
/* åœ“å½¢æŠ½çæ¡† */
#scrollArea { width: 420px; height: 420px; border: 8px solid #ffffff; display:flex; align-items:center; justify-content:center; font-size:1200%; font-weight:bold; margin-bottom:20px; position:relative; border-radius:50%; background: radial-gradient(circle at 30% 30%, #e0e0e0, #a9a9a9); font-family: "Comic Sans MS","è¯åº·æ‰‹æœ­é«”","å¾®è»Ÿæ­£é»‘é«”",sans-serif; text-align:center; box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2), inset 5px 5px 15px rgba(255,255,255,0.3), 5px 5px 20px rgba(0,0,0,0.3); }
#currentName { display:flex; align-items:center; justify-content:center; color:#888; font-size:80px; text-align:center; }
#history { width: 360px; max-height: 200px; overflow-y: scroll; margin-top: 10px; background: #fff; padding:10px; border-radius:10px; border:1px solid #ccc; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
#history div { margin-bottom:5px; }
#exportBtn { margin-top:5px; padding:8px 12px; border:none; border-radius:6px; background:#ff7f50; color:white; cursor:pointer; }
#exportBtn:hover { background:#ff5722; }
@keyframes flashRed {0%{ color: red; }50%{ color: black; }100%{ color: red; }}
</style>
</head>
<body>

<div class="left">
<h2>åƒåŠ è€…åå–®</h2>
<textarea id="names" placeholder="æ¯è¡Œè¼¸å…¥ä¸€ä½åƒåŠ è€…"></textarea>
<input type="text" id="prizeInput" placeholder="æœ¬æ¬¡æŠ½ççå“ï¼Œä¾‹å¦‚ï¼šiPad"><br>

<p>æ•¸å­—ç¯„åœç”Ÿæˆåå–®ï¼š</p>
èµ·å§‹:<input type="number" id="startNumber" value="1">
çµæŸ:<input type="number" id="endNumber" value="100">
<button class="btn-gray" onclick="generateNumberList()">ç”Ÿæˆè™Ÿç¢¼åå–®</button>

<p>æŠ½å¹¾å€‹ä¸­çè€…ï¼š</p>
<input type="number" id="winnerCount" value="1" min="1" style="width: 100%; margin-bottom:10px;">

<button class="btn-start" onclick="startDraw()">é–‹å§‹æŠ½ç</button>

<div style="display:flex; flex-wrap: wrap; gap:8px; margin-top:10px;">
  <button class="btn-gray" onclick="uploadCSV()">ä¸Šå‚³CSV</button>
  <button class="btn-gray" onclick="loadSample()">è¼‰å…¥ç¯„ä¾‹</button>
  <button class="btn-gray" onclick="clearList()">æ¸…ç©ºåå–®</button>
  <button class="btn-gray" onclick="clearHistory()">æ¸…é™¤æ­·å²ç´€éŒ„</button>
  <button class="btn-gray" onclick="openSettings()">å…¶ä»–</button>
</div>
</div>

<div class="right">
<div id="scrollArea">
<div id="currentName">å°šæœªæŠ½ç</div>
</div>
<div id="history"></div>
<button id="exportBtn" onclick="exportWinners()">åŒ¯å‡ºä¸­çåå–®</button>
</div>

<script>
let spinning=false;

// é¡¯ç¤ºä¸­çåå­—
function updateDisplay(name,color){
  const display=document.getElementById("currentName");
  if(!name){
    display.textContent="å°šæœªæŠ½ç";
    display.style.fontSize="80px";
    display.style.color="#888";
    display.style.animation="";
    return;
  }
  display.textContent=name;
  display.style.fontSize="200px";
  if(color){ display.style.color=color; display.style.animation="flashRed 0.6s 3"; }
  else{ display.style.color="#000"; display.style.animation=""; }
}

// æ­·å²ç´€éŒ„
function addHistory(winner){
  const historyDiv=document.getElementById("history");
  const prize=document.getElementById("prizeInput").value.trim()||"";
  const now=new Date();
  const timeString=now.toLocaleTimeString();
  const entry=document.createElement("div");
  entry.textContent=prize?`ğŸ‰ ${winner} ä¸­çï¼çå“ï¼š${prize} (${timeString})`:`ğŸ‰ ${winner} ä¸­çï¼ (${timeString})`;
  historyDiv.prepend(entry);
}

// æ¸…ç©ºæ­·å²
function clearHistory(){ document.getElementById("history").innerHTML=""; }

// é–‹å§‹æŠ½ç
async function startDraw(){
  if(spinning) return;
  let names=document.getElementById("names").value.trim().split("\n").filter(n=>n);
  if(names.length===0){ alert("è«‹è¼¸å…¥åƒåŠ è€…åå–®ï¼"); return; }
  const winnerNum=parseInt(document.getElementById("winnerCount").value)||1;
  const winners=[];
  spinning=true;
  for(let i=0;i<winnerNum;i++){
    if(names.length===0) break;
    let displayNames=names.slice();
    if(displayNames.length===0) displayNames.push("æŠ½çä¸­â€¦");
    let intervalTime=50; let slowDown=1.05; const totalTime=3000+Math.random()*2000; const startTime=Date.now();
    await new Promise(resolve=>{
      function roll(){
        const currentIndex=Math.floor(Math.random()*displayNames.length);
        updateDisplay(displayNames[currentIndex]);
        intervalTime*=slowDown;
        if(Date.now()-startTime<totalTime){ setTimeout(roll,intervalTime); }
        else{
          let specified=JSON.parse(localStorage.getItem("specifiedList")||"[]");
          let winner=specified.length>0?specified[Math.floor(Math.random()*specified.length)]:names[Math.floor(Math.random()*names.length)];
          winners.push(winner);
          names=names.filter(n=>n!==winner);
          document.getElementById("names").value=names.join("\n");
          if(specified.includes(winner)){ specified=specified.filter(n=>n!==winner); localStorage.setItem("specifiedList",JSON.stringify(specified)); }
          addHistory(winner);
          updateDisplay(winner,"red");
          resolve();
        }
      }
      roll();
    });
    await new Promise(r=>setTimeout(r,1000));
  }
  spinning=false;
}

// è¨­å®šå¯†ç¢¼
function openSettings(){
  const pwd=prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š");
  if(pwd==="911021"){
    let specifiedList=JSON.parse(localStorage.getItem("specifiedList")||"[]");
    let manual=prompt("æ‰‹å‹•æ–°å¢æŒ‡å®šåå–®(é€—è™Ÿåˆ†éš”)",specifiedList.join(","));
    if(manual){
      localStorage.setItem("specifiedList",JSON.stringify(manual.split(",").map(s=>s.trim()).filter(s=>s)));
      alert("å·²æ›´æ–°æŒ‡å®šåå–®ï¼");
    }
  }else{ alert("å¯†ç¢¼éŒ¯èª¤"); }
}

// CSV ä¸Šå‚³
function uploadCSV(){
  const input=document.createElement("input");
  input.type="file"; input.accept=".csv,text/csv";
  input.onchange=e=>{
    const file=e.target.files[0];
    const reader=new FileReader();
    reader.onload=function(){
      const lines=this.result.split(/\r?\n/).map(l=>l.split(",")[0]).filter(l=>l);
      document.getElementById("names").value=lines.join("\n");
      alert("CSV è¼‰å…¥å®Œæˆï¼");
    };
    reader.readAsText(file);
  };
  input.click();
}

// è¼‰å…¥ç¯„ä¾‹
function loadSample(){ document.getElementById("names").value="å¼µä¸‰\næå››\nç‹äº”"; }

// æ¸…ç©ºåå–®
function clearList(){ document.getElementById("names").value=""; updateDisplay(""); }

// ç”Ÿæˆæ•¸å­—åå–®
function generateNumberList(){
  const start=parseInt(document.getElementById("startNumber").value);
  const end=parseInt(document.getElementById("endNumber").value);
  if(isNaN(start)||isNaN(end)||start>end){ alert("è«‹è¼¸å…¥æ­£ç¢ºæ•¸å­—ç¯„åœï¼"); return; }
  const numbers=[];
  for(let i=start;i<=end;i++){ numbers.push(i.toString()); }
  document.getElementById("names").value=numbers.join("\n");
  updateDisplay("");
}

// åŒ¯å‡ºä¸­çåå–®
function exportWinners(){
  const history=document.getElementById("history").innerText;
  if(!history) { alert("ç›®å‰æ²’æœ‰ä¸­çåå–®ï¼"); return; }
  const blob=new Blob([history],{type:"text/csv;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="ä¸­çåå–®.csv"; document.body.appendChild(a); a.click();
  document.body.removeChild(a); URL.revokeObjectURL(url);
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>專業抽獎程式</title>
<style>
body {
  font-family: "Comic Sans MS","華康手札體","微軟正黑體",sans-serif;
  display: flex;
  margin: 0;
  height: 100vh;
  background: #f0f4f8;
}
/* 左側功能區 */
.left { width: 40%; padding: 20px; box-sizing: border-box; background: #ffffff; box-shadow: 3px 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
.left h2 { margin-top: 0; color: #333; border-bottom: 2px solid #ff7f50; padding-bottom: 5px; }
.left textarea { width: 95%; height: 220px; padding: 12px; font-size: 16px; border-radius: 12px; border: 1px solid #ccc; resize: none; margin-bottom: 15px; box-shadow: inset 0 0 8px rgba(0,0,0,0.05); }
.left input[type="text"], .left input[type="number"] { width: 48%; padding: 8px; margin: 5px 1%; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; box-sizing:border-box; }
.left button { padding: 10px 15px; margin: 5px 0; border: none; cursor:pointer; border-radius:8px; font-size:14px; font-weight:bold; transition: all 0.2s; }
.left button.btn-start { background: linear-gradient(45deg,#ff9a3c,#ff6f00); color:white; }
.left button.btn-start:hover { background: linear-gradient(45deg,#ff6f00,#ff9a3c); }
.left button.btn-gray { background:#9e9e9e; color:white; }
.left button.btn-gray:hover { background:#757575; }
/* 右側顯示區 */
.right { width: 60%; display: flex; align-items: center; justify-content:flex-start; background:#fdf6e3; flex-direction:column; position: relative; padding-top:60px; }
/* 圓形抽獎框 */
#scrollArea { width: 420px; height: 420px; border: 8px solid #ffffff; display:flex; align-items:center; justify-content:center; font-size:1200%; font-weight:bold; margin-bottom:20px; position:relative; border-radius:50%; background: radial-gradient(circle at 30% 30%, #e0e0e0, #a9a9a9); font-family: "Comic Sans MS","華康手札體","微軟正黑體",sans-serif; text-align:center; box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2), inset 5px 5px 15px rgba(255,255,255,0.3), 5px 5px 20px rgba(0,0,0,0.3); }
#currentName { display:flex; align-items:center; justify-content:center; color:#888; font-size:80px; text-align:center; }
#history { width: 360px; max-height: 200px; overflow-y: scroll; margin-top: 10px; background: #fff; padding:10px; border-radius:10px; border:1px solid #ccc; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
#history div { margin-bottom:5px; }
#exportBtn { margin-top:5px; padding:8px 12px; border:none; border-radius:6px; background:#ff7f50; color:white; cursor:pointer; }
#exportBtn:hover { background:#ff5722; }
@keyframes flashRed {0%{ color: red; }50%{ color: black; }100%{ color: red; }}
</style>
</head>
<body>

<div class="left">
<h2>參加者名單</h2>
<textarea id="names" placeholder="每行輸入一位參加者"></textarea>
<input type="text" id="prizeInput" placeholder="本次抽獎獎品，例如：iPad"><br>

<p>數字範圍生成名單：</p>
起始:<input type="number" id="startNumber" value="1">
結束:<input type="number" id="endNumber" value="100">
<button class="btn-gray" onclick="generateNumberList()">生成號碼名單</button>

<p>抽幾個中獎者：</p>
<input type="number" id="winnerCount" value="1" min="1" style="width: 100%; margin-bottom:10px;">

<button class="btn-start" onclick="startDraw()">開始抽獎</button>

<div style="display:flex; flex-wrap: wrap; gap:8px; margin-top:10px;">
  <button class="btn-gray" onclick="uploadCSV()">上傳CSV</button>
  <button class="btn-gray" onclick="loadSample()">載入範例</button>
  <button class="btn-gray" onclick="clearList()">清空名單</button>
  <button class="btn-gray" onclick="clearHistory()">清除歷史紀錄</button>
  <button class="btn-gray" onclick="openSettings()">其他</button>
</div>
</div>

<div class="right">
<div id="scrollArea">
<div id="currentName">尚未抽獎</div>
</div>
<div id="history"></div>
<button id="exportBtn" onclick="exportWinners()">匯出中獎名單</button>
</div>

<script>
let spinning=false;

// 顯示中獎名字
function updateDisplay(name,color){
  const display=document.getElementById("currentName");
  if(!name){
    display.textContent="尚未抽獎";
    display.style.fontSize="80px";
    display.style.color="#888";
    display.style.animation="";
    return;
  }
  display.textContent=name;
  display.style.fontSize="200px";
  if(color){ display.style.color=color; display.style.animation="flashRed 0.6s 3"; }
  else{ display.style.color="#000"; display.style.animation=""; }
}

// 歷史紀錄
function addHistory(winner){
  const historyDiv=document.getElementById("history");
  const prize=document.getElementById("prizeInput").value.trim()||"";
  const now=new Date();
  const timeString=now.toLocaleTimeString();
  const entry=document.createElement("div");
  entry.textContent=prize?`🎉 ${winner} 中獎！獎品：${prize} (${timeString})`:`🎉 ${winner} 中獎！ (${timeString})`;
  historyDiv.prepend(entry);
}

// 清空歷史
function clearHistory(){ document.getElementById("history").innerHTML=""; }

// 開始抽獎
async function startDraw(){
  if(spinning) return;
  let names=document.getElementById("names").value.trim().split("\n").filter(n=>n);
  if(names.length===0){ alert("請輸入參加者名單！"); return; }
  const winnerNum=parseInt(document.getElementById("winnerCount").value)||1;
  const winners=[];
  spinning=true;
  for(let i=0;i<winnerNum;i++){
    if(names.length===0) break;
    let displayNames=names.slice();
    if(displayNames.length===0) displayNames.push("抽獎中…");
    let intervalTime=50; let slowDown=1.05; const totalTime=3000+Math.random()*2000; const startTime=Date.now();
    await new Promise(resolve=>{
      function roll(){
        const currentIndex=Math.floor(Math.random()*displayNames.length);
        updateDisplay(displayNames[currentIndex]);
        intervalTime*=slowDown;
        if(Date.now()-startTime<totalTime){ setTimeout(roll,intervalTime); }
        else{
          let specified=JSON.parse(localStorage.getItem("specifiedList")||"[]");
          let winner=specified.length>0?specified[Math.floor(Math.random()*specified.length)]:names[Math.floor(Math.random()*names.length)];
          winners.push(winner);
          names=names.filter(n=>n!==winner);
          document.getElementById("names").value=names.join("\n");
          if(specified.includes(winner)){ specified=specified.filter(n=>n!==winner); localStorage.setItem("specifiedList",JSON.stringify(specified)); }
          addHistory(winner);
          updateDisplay(winner,"red");
          resolve();
        }
      }
      roll();
    });
    await new Promise(r=>setTimeout(r,1000));
  }
  spinning=false;
}

// 設定密碼
function openSettings(){
  const pwd=prompt("請輸入密碼：");
  if(pwd==="911021"){
    let specifiedList=JSON.parse(localStorage.getItem("specifiedList")||"[]");
    let manual=prompt("手動新增指定名單(逗號分隔)",specifiedList.join(","));
    if(manual){
      localStorage.setItem("specifiedList",JSON.stringify(manual.split(",").map(s=>s.trim()).filter(s=>s)));
      alert("已更新指定名單！");
    }
  }else{ alert("密碼錯誤"); }
}

// CSV 上傳
function uploadCSV(){
  const input=document.createElement("input");
  input.type="file"; input.accept=".csv,text/csv";
  input.onchange=e=>{
    const file=e.target.files[0];
    const reader=new FileReader();
    reader.onload=function(){
      const lines=this.result.split(/\r?\n/).map(l=>l.split(",")[0]).filter(l=>l);
      document.getElementById("names").value=lines.join("\n");
      alert("CSV 載入完成！");
    };
    reader.readAsText(file);
  };
  input.click();
}

// 載入範例
function loadSample(){ document.getElementById("names").value="張三\n李四\n王五"; }

// 清空名單
function clearList(){ document.getElementById("names").value=""; updateDisplay(""); }

// 生成數字名單
function generateNumberList(){
  const start=parseInt(document.getElementById("startNumber").value);
  const end=parseInt(document.getElementById("endNumber").value);
  if(isNaN(start)||isNaN(end)||start>end){ alert("請輸入正確數字範圍！"); return; }
  const numbers=[];
  for(let i=start;i<=end;i++){ numbers.push(i.toString()); }
  document.getElementById("names").value=numbers.join("\n");
  updateDisplay("");
}

// 匯出中獎名單
function exportWinners(){
  const history=document.getElementById("history").innerText;
  if(!history) { alert("目前沒有中獎名單！"); return; }
  const blob=new Blob([history],{type:"text/csv;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="中獎名單.csv"; document.body.appendChild(a); a.click();
  document.body.removeChild(a); URL.revokeObjectURL(url);
}
</script>

</body>
</html>